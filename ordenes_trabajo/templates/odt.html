{% extends './layouts/base.html' %}

{% block title %}GO Services{% endblock %}

{% block content %}
<div class="container bg-light rounded-3 mb-5">
  <div class="d-flex justify-content-between align-items-center m-4">
    <div class="m-4">
      <h1 class="h3 mb-0 text-black">Órdenes de Trabajo</h1>
      <p class="text-muted">Gestiona todas las órdenes de trabajo del sistema</p>
    </div>
    <form action="{% url 'buscar_odt' %}" method="post">
      {% csrf_token %}
      <div class="d-flex gap-2">
        <input type="text" name="search" id="search" class="form-control"
          placeholder="Buscar ODT por número o cliente">
        <button type="submit" class="btn btn-primary btn-search px-2 align-self-stretch">
          <i class="fas fa-search me-2"></i>Buscar
        </button>
      </div>
    </form>

    <a class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#nuevaOdtModal">
      <i class="fas fa-plus me-2"></i>Nueva ODT
    </a>
  </div>
  <div class="container-fluid">
    {% if orden %}
    <div class="row">
      {% for odt in orden %}
      <div class="col-md-4 mb-4">
        <div class="card shadow" style="width: 100%;">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-3 bg-secondary rounded-3 p-2">
              <h5 class="card-title text-white mb-0">{{ odt.odtTipoMaquina }}</h5>
              <p class="text-white mb-0 small">{{ odt.odtNumero }}</p>
            </div>
            <div class="mb-3">
              <p class="mb-1"><strong>Marca:</strong> {{ odt.odtMarca }}</p>
              <p class="mb-1"><strong>Modelo:</strong> {{ odt.odtModelo }}</p>
            </div>
            <div class="mb-3">
              <p class="mb-1"><strong>Cliente:</strong> {{ odt.odtClientName }}</p>
              <p class="mb-1"><strong>Teléfono:</strong> {{ odt.odtClientPhone }}</p>
              <p class="mb-1"><strong>Dirección:</strong> {{ odt.odtClientEmail }}</p>
              <p class="mb-1"><strong>Falla:</strong> {{ odt.odtFalla }}</p>
            </div>
            <div class="mb-3">
              <p class="mb-1"><strong>Fecha:</strong> {{ odt.odtFecha }}</p>
              <span class="badge bg-primary p-2 rounded-3">{{ odt.odtEstado }}</span>
            </div>
            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
              <button type="button" class="btn btn-primary me-md-2 btn-modal" data-bs-toggle="modal"
                data-bs-target="#odtModal" data-objeto-id="{{ odt.odtId }}">
                Revisar
              </button>
              <a href="{% url 'eliminar_odt' odt.odtId %}" class="btn btn-danger">Eliminar {{ odt.odtId }}</a>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div class="row">
      <div class="col-12">
        <div class="text-center py-5">
          <i class="fas fa-clipboard-list fa-3x text-muted mb-3"></i>
          <h4>No hay órdenes de trabajo</h4>
          <p class="text-muted">Aún no se han creado órdenes de trabajo en el sistema.</p>
        </div>
      </div>
    </div>
    {% endif %}
  </div>
</div>

<div class="modal fade" id="nuevaOdtModal" tabindex="-1" aria-labelledby="nuevaOdtModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h4 class="modal-title" id="nuevaOdtModalLabel">
          <i class="fas fa-plus me-2"></i>Nueva Orden de Trabajo
        </h4>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form action="{% url 'crear_odt' %}" method="post" id="nuevaOdtForm">
        <div class="modal-body">
          {% csrf_token %}

          <!-- Información del Cliente -->
          <div class="card mb-4">
            <div class="card-header">
              <h5 class="mb-0"><i class="fa-solid fa-circle-user"></i>Información del Cliente</h5>
            </div>
          </div>

          <div class="card-body bg-light rounded-3 p-4 shadow mb-4">
            <div class="row">
              <div class="col-md-6">
                <div class="mb-2">
                  <label for="clientName" class="form-label text-black">Nombre: </label>
                  <input type="text" class="form-control" id="clientName" name="client_name"
                    placeholder="Ingrese nombre del cliente" required>
                </div>
              </div>

              <div class="col-md-6">
                <div class="mb-3">
                  <label for="clientNumber" class="form-label text-black">Número: </label>
                  <input type="tel" class="form-control" id="clientNumber" name="client_number"
                    placeholder="Ingrese número del cliente" required>
                </div>
              </div>

              <div class="col-md-6">
                <div class="mb-3">
                  <label for="clientEmail" class="form-label text-black">Correo: </label>
                  <input type="email" class="form-control" id="clientEmail" name="client_email"
                    placeholder="Ingrese correo del cliente" required>
                </div>
              </div>

              <div class="col-md-6">
                <div class="mb-3">
                  <label for="clientAdress" class="form-label text-black">Dirección: </label>
                  <input type="text" class="form-control" id="clientAdress" name="client_address"
                    placeholder="Ingrese Dirección del cliente" required>
                </div>
              </div>

            </div>
          </div>

          <!-- Impresora -->
          <div class="card mb-4">
            <div class="card-header">
              <h5 class="mb-0"><i class="fas fa-cogs me-2"></i>Información de la impresora</h5>
            </div>
          </div>

          <div class="card-body bg-light rounded-3 p-4 shadow">
            <div class="row">
              <div class="col-md-6">
                <div class="mb-2">
                  <label for="typeMachine" class="form-label text-black">Tipo de Máquina: </label>
                  <select class="form-select" id="typeMachine" name="type_machine" required>
                    <option value="" disabled selected>Seleccione tipo de máquina</option>
                    <option value="Impresora">Impresora</option>
                    <option value="Plotter">Plotter</option>
                  </select>
                </div>
              </div>

              <div class="col-md-6">
                <div class="mb-3">
                  <label for="brand" class="form-label text-black">Marca: </label>
                  <select class="form-select" id="brand" name="brand" required>
                    <option value="" disabled selected>Seleccione Marca</option>
                    <option value="Epson">Epson</option>
                    <option value="Brother">Brother</option>
                    <option value="Canon">Canon</option>
                    <option value="HP">HP</option>
                  </select>
                </div>

              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="model" class="form-label text-black">Modelo: </label>
                  <input type="text" class="form-control" id="model" name="model"
                    placeholder="Ingrese modelo de la impresora" required>
                </div>
              </div>

              <div class="col-md-6">
                <div class="mb-3">
                  <label for="serialNumber" class="form-label text-black">Número de Serie: </label>
                  <input type="text" class="form-control" id="serialNumber" name="serial_number"
                    placeholder="Ingrese número de serie de la impresora" required>
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="fault" class="form-label text-black">Falla: </label>
                  <input type="text" class="form-control" id="fault" name="fault"
                    placeholder="Ingrese falla de la impresora" required>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="card mb-4">
          <div class="card-header">
            <h5 class="mb-0"><i class="fas fa-cogs me-2"></i>Información Pago</h5>
          </div>
        </div>

        <div class="card-body bg-light rounded-3 p-4 shadow">
          <div class="row">
            <div class="col-md-6">
              <div class="mb-2">
                <label for="diagnosticpay" class="form-label text-black">Diagnóstico: </label>
                <input type="text" class="form-control" id="diagnosticpay" name="diagnostic_pay"
                  placeholder="Ingrese costo del diagnóstico" required>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-2">
                <label for="odtPaymentForm" class="form-label text-black">Forma de pago: </label>
                <select class="form-select" id="odtPaymentForm" name="odtPaymentForm" required>
                  <option value="" disabled selected>Seleccione forma de pago</option>
                  <option value="Efectivo">Efectivo</option>
                  <option value="Débito">Débito</option>
                  <option value="Crédito">Crédito</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            <i class="fas fa-times me-2"></i>Cancelar
          </button>
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-save me-2"></i>Crear ODT
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="modal fade" id="odtModal" tabindex="-1" aria-labelledby="odtModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title text-black" id="odtModalLabel">Detalles de la Orden de Trabajo</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-md-6">
            <div class="card">
              <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-cogs me-2"></i>Información del Equipo</h6>
              </div>
              <div class="card-body">
                <p><strong>Tipo de Máquina:</strong> <span id="modalTypeMachine"></span></p>
                <p><strong>Marca:</strong> <span id="modalBrand"></span></p>
                <p><strong>Modelo:</strong> <span id="modalModel"></span></p>
              </div>
            </div>
          </div>

          <div class="col-md-6">
            <div class="card">
              <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-user me-2"></i>Información del Cliente</h6>
              </div>
              <div class="card-body">
                <p><strong>Nombre:</strong> <span id="modalClientName"></span></p>
                <p><strong>Teléfono:</strong> <span id="modalCelNum"></span></p>
              </div>
            </div>
          </div>
        </div>

        <div class="row mt-3">
          <div class="col-md-6">
            <div class="card">
              <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-info-circle me-2"></i>Estado y Fechas</h6>
              </div>
              <div class="card-body">
                <p><strong>Estado:</strong> <span id="modalStatus" class="badge bg-primary"></span></p>
                <p><strong>Fecha de Creación:</strong> <span id="modalCreatedAt"></span></p>
                <p><strong>Prioridad:</strong> <span id="modalPriority"></span></p>
              </div>
            </div>
          </div>

          <div class="col-md-6">
            <div class="card">
              <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-tools me-2"></i>Información Técnica</h6>
              </div>
              <div class="card-body">
                <p><strong>Técnico Asignado:</strong> <span id="modalTechnician"></span></p>
                <p><strong>Costo Estimado:</strong> <span id="modalEstimatedCost"></span></p>
                <p><strong>Tiempo Estimado:</strong> <span id="modalEstimatedTime"></span></p>
              </div>
            </div>
          </div>
        </div>

        <div class="card mt-3">
          <div class="card-header">
            <h6 class="mb-0"><i class="fas fa-file-alt me-2"></i>Descripción del Problema</h6>
          </div>
          <div class="card-body">
            <p id="modalDescription" class="mb-0"></p>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
        <button type="button" class="btn btn-primary" onclick="editOdt()">
          <i class="fas fa-edit me-2"></i>Editar ODT
        </button>
        <button type="button" class="btn btn-success" onclick="changeStatus()">
          <i class="fas fa-check me-2"></i>Cambiar Estado
        </button>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block addicional_script %}
{% endblock %}